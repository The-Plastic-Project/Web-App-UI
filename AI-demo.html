<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>TensorFlow Demo</title>
  <link rel="stylesheet" href="style.css">
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
</head>

<body>
  <nav class="navbar nav-justified fixed-bottom" id="navbar">
    <a class="nav-link" href="index.html" style="color:black">
      <div class="container">
        <div class="col">
          <div class="row">
            <iconify-icon icon="ic:outline-home" width="full" height="45" style="color: black;"></iconify-icon>
          </div>
          <div class="row justify-content-center">
            Home
          </div>
        </div>
      </div>
    </a>
    <a class="nav-link disabled" style="color:black">
      <div class="container">
        <div class="col">
          <div class="row">
            <iconify-icon icon="mdi:orbit-variant" width="full" height="45" style="color: black;"></iconify-icon>
          </div>
          <div class="row justify-content-center">
            Identify
          </div>
        </div>
      </div>
    </a>
    <a class="nav-link" href="local.html" style="color:black">
      <div class="container">
        <div class="col">
          <div class="row">
            <iconify-icon icon="mdi:shop-outline" width="full" height="45" style="color: black;"></iconify-icon>
          </div>
          <div class="row justify-content-center">
            Shop
          </div>
        </div>
      </div>
    </a>
  </nav>

  <div class="w-100 fixed-top" style="height: 60px; background-color: #faece1;"></div>

  <div id="content">

    <main class="m-3">
      <div style="height:60px"></div>
      <h1 class="mb-3 fw-bold" style="text-align:center">Classify Waste Using Artifical Intelligence</h1>
      <div class="mb-5 d-flex justify-content-center" id="picture-div">
        <div style=" background-color: #faece1; width: 87.2%;border-radius: 25px;">
          <div style="height: 320px">
            <img id="img" class="img-fluid" style="height: 320px" src="" />
          </div>
        </div>
      </div>
      <div class="mb-5 container">
        <div class="row" style="margin-top: -20px; margin-bottom:-20px">
          <div class="col d-flex justify-content-center">
            <button class="btn" style="width: 300px; background-color: #CCDDDA; border-radius: 9px;"
              onclick="HandleBrowseClick()" ;>Upload Image</button>

          </div>
        </div>
      </div>

      <input type="file" (change)="getFile($event)" id="fileInput" name="image" accept="image/*" capture="environment">

      <div class="d-flex justify-content-center" id="results-div">
        <div class="p-3" style="background-color: #faece1; width: 87.2%; border-radius: 25px;">
          <h3 id="result" role="alert">Identified As: Plastic Bottle</h3>
          <p id="results-detailed" class="text-break" role="alert" style="margin-top: 1rem; visibility: hidden;">
            Recognizing...
          </p>
        </div>
      </div>


      <div class="d-flex justify-content-center" id="info-div">
        <div class="p-3"
          style="background-color: #faece1; width: 87.2%; border-radius: 25px; margin-top: 30px; margin-bottom: 30px">
          <h3>A note on usage</h3>
          <p class="text-break">In most cities, garbage is not sorted after it is picked up. Also, just because a
            product
            has a recycle symbol does NOT mean that it can always be recycled. Be sure to clean waste that goes into the
            recycling first. Most rules here apply in all cities, but sometimes more metal products can be recycled, so
            check the conditions for your city.</p>
        </div>
      </div>
  </div>

  <script>

    var is_mobile = !!navigator.userAgent.match(/iphone|android|blackberry/ig) || false;

    if (!is_mobile) {
      const content = document.getElementById('content');
      content.setAttribute("style", "width:60%; margin: auto;")
    }

    // handle click
    function HandleBrowseClick() {
      var fileinput = document.getElementById("fileInput");
      fileinput.click();
    }

    // hide things
    document.getElementById('picture-div').style.display = "none";

    // classify image
    const img = document.getElementById('img');
    const result = document.getElementById('result');
    const results_detailed = document.getElementById('results-detailed');
    document.getElementById('fileInput').addEventListener("change", e => {
      result.style.visibility = 'visible';
      result.textContent = 'Recognizing...';
      result.scrollIntoView();
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = async (e) => {
        const base64 = e.target.result;
        img.setAttribute('src', base64);
        const url = 'https://onklb0qxvc.execute-api.us-west-1.amazonaws.com/dev';
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          redirect: 'follow',
          referrerPolicy: 'no-referrer',
          body: JSON.stringify({file: base64})
        });
        const recognizedObject = await response.json();
        result.textContent = "Identified as: " + JSON.parse(recognizedObject.result)
        results_detailed.style.visibility = 'visible';
        results_detailed.textContent = JSON.parse(recognizedObject.message)
      }
    });
  </script>

  <div style="height: 100px"></div>

</body>

</html>