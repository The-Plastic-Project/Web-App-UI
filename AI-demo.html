<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>TensorFlow Demo</title>
  <link rel="stylesheet" href="style.css">
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
  <link rel="manifest" href="/manifest.json" />
</head>

<body>
  <!-- Nav Bar -->
  <nav class="navbar nav-justified fixed-bottom" id="navbar" style="padding-top:0">
    <a class="nav-link" href="/index.html" style="color: black;">
      <div class="container">
        <div class="col">
          <iconify-icon icon="ic:outline-home" height="45" style="color: black;"></iconify-icon>
          <div class="row justify-content-center">
            Home
          </div>
        </div>
      </div>
    </a>
    <a class="nav-link" href="AI-demo.html" style="color:black">
      <div class="container">
        <div class="col">
          <iconify-icon icon="mdi:orbit-variant" height="45" style="color: black;"></iconify-icon>
          <div class="row justify-content-center" style="margin:0">
            Identify
          </div>
        </div>
      </div>
    </a>
    <a class="nav-link" href="local.html" style="color:black">
      <div class="container">
        <div class="col">
          <iconify-icon icon="mdi:shop-outline" height="45" style="color: black;"></iconify-icon>
          <div class="row justify-content-center">
            Shop
          </div>
        </div>
      </div>
    </a>
  </nav>
  <div id="content">

    <main class="m-3">
      <div style="height:60px"></div>
      <h1 class="mb-3 fw-bold" style="text-align:center">Classify Waste Using Artifical Intelligence</h1>
      <div class="mb-5 d-flex justify-content-center hide-before-res">
        <div id="picture-div">
          <div id="image-bg-div">
            <img id="img" class="img-fluid" src="" style="border-radious:25px" />
          </div>
        </div>
      </div>
      <div class="mb-5 container">
        <div class="row"">
          <div class=" col d-flex justify-content-center">
          <button class="btn" id="upload-btn" onclick="HandleBrowseClick()" ;>Upload Image</button>

        </div>
      </div>
  </div>

  <input type="file" (change)="getFile($event)" id="fileInput" name="image" accept="image/*" capture="environment">

  <div class="d-flex justify-content-center hide-before-res" id="results-div">
    <div class="p-3" style="background-color: #faece1; width: 87.2%; border-radius: 25px;" id="results-div">
      <h3 id="result" role="alert">Identified As: Plastic Bottle</h3>
      <p id="results-detailed" class="text-break" role="alert" style="margin-top: 1rem; visibility: hidden;">
        Recognizing...
      </p>
    </div>
  </div>


  <div class="d-flex justify-content-center" id="info-div">
    <div class="p-3" id="note-div"
      style="background-color: #faece1; width: 87.2%; border-radius: 25px; margin-top: 30px; margin-bottom: 30px">
      <h3>A note on usage</h3>
      <p class="text-break">In most cities, garbage is not sorted after it is picked up. Also, just because a
        product
        has a recycle symbol does NOT mean that it can always be recycled. Be sure to clean waste that goes into the
        recycling. Most rules here apply in all cities, but sometimes more metal products can be recycled, so
        check the conditions for your city.</p>
    </div>
  </div>
  </div>

  <script>

    var is_mobile = !!navigator.userAgent.match(/iphone|android|blackberry/ig) || false;

    if (!is_mobile) {
      const content = document.getElementById('content');
      console.log("RECOGNIZED")
      content.setAttribute("style", "width:60%; margin: auto;")
    }

    document.getElementById('results-div').style.visibility = 'hidden'
    document.getElementById('picture-div').style.visibility = 'hidden'
    document.getElementById('note-div').style.visibility = 'hidden'


    // handle click
    function HandleBrowseClick() {
      var fileinput = document.getElementById("fileInput");
      fileinput.click();
    }

    // classify image
    const img = document.getElementById('img');
    const result = document.getElementById('result');
    const results_detailed = document.getElementById('results-detailed');
    document.getElementById('fileInput').addEventListener("change", e => {
      document.getElementById('results-div').style.visibility = 'visible'
      document.getElementById('picture-div').style.visibility = 'visible'
      document.getElementById('note-div').style.visibility = 'visible'
      document.getElementById('upload-btn').style.visibility = 'hidden'
      result.style.visibility = 'visible';
      result.textContent = 'Recognizing...';
      results_detailed.style.visibility = 'visible';
      results_detailed.textContent = 'Information on how to proceed with your product will appear here.'
      result.scrollIntoView();
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = async (e) => {
        const base64 = e.target.result;
        img.setAttribute('src', base64);
        const url = 'https://onklb0qxvc.execute-api.us-west-1.amazonaws.com/dev';
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          redirect: 'follow',
          referrerPolicy: 'no-referrer',
          body: JSON.stringify({file: base64})
        });
        const recognizedObject = await response.json();
        result.textContent = "Identified as: " + JSON.parse(recognizedObject.result)
        results_detailed.textContent = JSON.parse(recognizedObject.message)
      }
    });
  </script>

  <div style="height: 100px"></div>

</body>

</html>